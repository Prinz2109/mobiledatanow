<canvas debug="true">
    <include href="opttree/library.lzx"/>
    <include href="debug/prettyprinter.lzx" />
    <include href="dummydata.lzx" />

    <!-- TODO: Add multi/single selection example here. -->

    <dataset name="dsClone0" />
    <view><!-- dummy view to clone dataset once this is initializing  -->
        <handler name="oninit">
        <![CDATA[
            var dpTree = new LzDatapointer();
            var dp = new LzDatapointer();

            //first dynamic tree
            dpTree.setAttribute('xpath','dsClone0:/');
            dp.setXPath('livingThings:/root');
            Debug.write(dp);
            dpTree.addNodeFromPointer(dp);
         ]]>
        </handler>
    </view>

    <class name="simpletreenode" extends="sharedtreenode">
        <attribute name="folderstate" 
                   value="$path{'@_folderstate'}" />
    </class>
    

    <prettyprinter name="pp" xpath="dsFlat:/" />

    <window title="Shopping List"
            x="20" y="20" width="200" height="300" resizable="true">
       <view width="100%" height="100%" clip="true">
        <opttree id="main" datapath="dsFlat:/root"
                nodepath="node" nodeclass="simpletreenode"
                showtreelines="false"
                width="${immediateparent.width-15}">
        </opttree>
        <scrollbar />
      </view>
    </window>

    <window title="Living Things" 
            x="460" y="20" width="200" height="300" resizable="true">
      <view width="100%" height="100%" clip="true">
        <opttree id="treeTwo" datapath="livingThings:/root"
                nodepath="node" nodeclass="simpletreenode"
                showtreelines="false"
                width="${immediateparent.width-15}">
        </opttree>
        <scrollbar />
      </view>
    </window>

    <window title="Living Things (with line)"
            x="685" y="20" width="200" height="300" resizable="true">
      <view width="100%" height="100%" clip="true">
        <opttree id="treeThree" datapath="dsClone0:/root"
                nodepath="node" nodeclass="simpletreenode"
                showtreelines="true"
                width="${immediateparent.width-15}">
        </opttree>
        <scrollbar />
      </view>
    </window>

    <!-- Test Harness for tree with lines -->
    <window x="460" y="328">
        <simplelayout axis="x" spacing="10" />
        <node name="dps">
            <datapointer name="livingThings"
                         xpath="livingThings:/root/node[1]" />
            <datapointer name="eukaryota"
                         xpath="livingThings:/root/node[1]/node[3]" />
            <datapointer name="animalia"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]" />
            <datapointer name="chordata"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]" />
            <datapointer name="vert"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]" />
            <datapointer name="mam"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]/node[1]" />
            <datapointer name="carn"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]" />
            <datapointer name="primatesj"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]" />
            <datapointer name="hominidae"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]/node[2]" />
            <datapointer name="homo"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]/node[2]/node[1]" />
            <datapointer name="sapiens"
                         xpath="livingThings:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]/node[2]/node[1]/node[1]" />
        </node>
        <node name="dps2">
            <datapointer name="dsClone0"
                         xpath="dsClone0:/root/node[1]" />
            <datapointer name="eukaryota"
                         xpath="dsClone0:/root/node[1]/node[3]" />
            <datapointer name="animalia"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]" />
            <datapointer name="chordata"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]" />
            <datapointer name="vert"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]" />
            <datapointer name="mam"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]/node[1]" />
            <datapointer name="carn"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]" />
            <datapointer name="primatesj"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]" />
            <datapointer name="hominidae"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]/node[2]" />
            <datapointer name="homo"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]/node[2]/node[1]" />
            <datapointer name="sapiens"
                         xpath="dsClone0:/root/node[1]/node[3]/node[4]/node[1]/node[1]/node[1]/node[2]/node[2]/node[1]/node[1]" />
        </node>
        <button>Open Tree to Humans
            <handler name="onclick"><![CDATA[
                for (var i=0; i<parent.dps.subnodes.length;i++) {
                    var n = parent.dps.subnodes[i];
                    var openAttr = treeTwo.openattr;
                    n.setNodeAttribute(openAttr, "true");
                }
            ]]>
            </handler>
        </button>
        <button>Open Tree to Humans (tree with Line)
            <handler name="onclick"><![CDATA[
                for (var i=0; i<parent.dps.subnodes.length;i++) {
                    var n = parent.dps2.subnodes[i];
                    var openAttr = treeThree.openattr;
                    n.setNodeAttribute(openAttr, "true");
                }
            ]]>
            </handler>
        </button>
    </window>

    <!-- Test Harness -->
    <window x="240" y="20">
        <simplelayout axis="y" spacing="10" />
        <handler name="onselect" reference="main" args="sel">
        <![CDATA[
            Debug.write( ">> ONSELECT SENT. NODE SELECTED: ", sel, " CURRENT SELECTION: ", main.getSelection() );
        ]]>
        </handler>

        <button>Write out dataset
            <handler name="onclick">
                pp.prettyPrint();
            </handler>
        </button>

        <button>Get Selection
            <handler name="onclick">
                Debug.write("CURRENT SELECTION: ", main.getSelection());
            </handler>
        </button>

        <button>Clear Selection
            <handler name="onclick">
                main.clearSelection();
                Debug.write("CLEARING SELECTION");
            </handler>
        </button>

        <button>Make selectable
            <handler name="onclick">
                main.setAttribute("selectable", true);
            </handler>
        </button>

        <button>Make not selectable
            <handler name="onclick">
                main.setAttribute("selectable", false);
            </handler>
        </button>

        <button>Make multi-selectable
            <handler name="onclick">
                main.setAttribute("multiselect", true);
            </handler>
        </button>

        <button>Make not multi-selectable
            <handler name="onclick">
                main.setAttribute("multiselect", false);
            </handler>
        </button>
         
    </window>
</canvas>
